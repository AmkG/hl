(int 9)
(halt )

;^9$

; *** Some consing ***

(int 1)
(int 2)
(cons )
(cdr )
(halt )

;^2$

; *******

(int 1)
(int 2)
(cons )
(car )
(halt )

;^1$

; *** Basic closure ***

(closure 0 
  (check-vars 2)
  (car-local-push 1)
  (halt ))
(int 1)
(int 2)
(cons )
(apply 2)

;^1$

; *** if ***

(closure 0 
  (check-vars 2)
  (if-local 1
    (cdr-local-push 1)
    (halt ))
  (halt ))
(int 1)
(int 2)
(cons )
(apply 2)

;^2$

; ******

(closure 0 
  (check-vars 2)
  (if-local 1
    (cdr-local-push 1)
    (halt ))
  (int 42)
  (halt ))
(lit-nil )
(apply 2)

;^42$

; *** Closures that close something ***

(int 42)
(closure 1
  (check-vars 1)
  (closure-ref 0)
  (halt ))
(apply 1)

;^42$

; *** This will fail: objects pushed on the stack lose their dynamic type information (why?) ***

(int 1)
(lit-nil )
(cons )
(int 2)
(closure 2
  (check-vars 1)
  (closure-ref 0)
  (car )
  (halt ))
(apply 1)

;^1$
